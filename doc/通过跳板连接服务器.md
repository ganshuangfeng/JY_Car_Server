# 跳板服务器

   * 服务器的 ssh 端口、数据库 端口 都不对外网公开。
   * 开放一台跳板服务器，所有 ssh 和 数据库 连接，均通过 跳板服务器。


# xshell 管理服务器

   1. 跳板服务器 配置
      * 连接参数 主机 ip：47.106.175.111 （外网地址）
      * 连接参数 端口号 : 22
      * 用户名/密码
      * SSH -> 隧道：添加 => 类型选 SOCKS4/5 , 侦听端口填 8668 , 勾上‘仅接受本地连接’
      * 代理 -> 浏览： 添加 => 名称填 代理8668, 类型选 SOCKS4/5 , 主机 127.0.0.1, 端口 8668 。确定 保存，注意：最后确定界面中，‘代理服务器’一栏一定要选 <无> ！

   2. 应用服务器 配置
      * 连接参数 主机 ip: （内网地址）
      * 连接参数 端口号 : 22
      * 用户名/密码
      * 代理 -> 代理服务器 列表中 选择 ‘代理8668’。

   3. 使用方法
      * 先连接跳板服务器，再连接应用服务器即可

# xftp 文件管理

   1. 配置
      * 常规 -> 主机 ip： 内网地址
      * 常规 -> 端口号： 22
      * 常规 -> 代理服务器： 列表中 选择 ‘代理8668’。
   2. 使用方法
      * 先在 xshell 中连接跳板服务器（如果已连接，忽略此步骤）
      * 连接要管理的服务器

# navicat 连接数据库

   1. 配置
      * 主机 ip ：（内网地址）
      * 端口
      * SSH -> 勾选‘使用 SSH 通道’ -> 主机 47.106.175.111,端口 22，用户名/密码

# 命令行代理模式

   1. 连接跳板并开启代理： 
   ```
      ssh -o TCPKeepAlive=yes -D 8668 root@47.106.175.111
   ```
   2. 使用代理连接应用服务器：
   ```
      ssh -o ProxyCommand='nc -x 127.0.0.1:8668 %h %p' username@xxx.xxx.xxx.xxx
   ```

# 端口转发模式：在不方便使用代理时用

## 步骤
   1. 在本地建立转发端口
   ```
   ssh -o TCPKeepAlive=yes -L <本地端口>:<阿里云内网地址>:<端口> root@47.106.175.111
   ```
   2. 通过本地端口连接服务器
   ```
   将原本要连接的服务器 ip 改为 127.0.0.1 ，端口改为上述的 <本地端口>
   ```

## 举例

* web 测试服 ssh
   1. 建立转发端口
   ```
   ssh -o TCPKeepAlive=yes -L 9001:172.18.107.228:22 root@47.106.175.111
   ```
   2. 连接 ssh
   ```
   ssh -p 9001 root@127.0.0.1
   ```
* web 正式服 ssh
   1. 建立转发端口
   ```
   ssh -o TCPKeepAlive=yes -L 9002:172.18.107.232:22 root@47.106.175.111
   ```
   2. 连接 ssh
   ```
   ssh -p 9002 root@127.0.0.1
   ```
* 测试服 mysql
   1. 建立转发端口
   ```
   ssh -o TCPKeepAlive=yes -L 9003:172.18.107.229:3306 root@47.106.175.111
   ```
   2. 连接数据库
   ```
   使用 127.0.0.1:9003 连接数据库
   ```
* 下载服务器远程桌面
   1. 建立转发端口
   ```
   ssh -o TCPKeepAlive=yes -L 9004:172.18.107.230:3389 root@47.106.175.111
   ```
   2. 连接远程桌面
   ```
   ‘远程桌面连接’中使用 127.0.0.1:9004
   ```
    